ğŸ” What is CSRF?

CSRF = Cross-Site Request Forgery

It is an attack where a malicious website tricks a logged-in user into performing unwanted actions on another trusted website.

Example

Suppose you're logged into your banking app:

ğŸ‘‰ bank.com

Your browser stores session cookie automatically.

Now you visit a malicious site:

ğŸ‘‰ evil.com

That site secretly sends this request:

<img src="https://bank.com/transfer?to=attacker&amount=10000" />


Browser automatically sends your session cookie.

Bank sees:

Valid session cookie

Valid request

And processes it.

That is CSRF.

ğŸ¯ Why It Happens

Because:

Browser automatically sends cookies.

Server trusts session cookie.

No extra validation is done.

ğŸ”‘ What is a CSRF Token?

A CSRF token is:

A random, unique value generated by the server and stored in the user session.

Every state-changing request (POST, PUT, DELETE) must include this token.

Server verifies:

Is token present?

Does it match session?

If yes â†’ allow.
If no â†’ reject.

ğŸ” How Spring Security Handles CSRF

By default:

CSRF protection is enabled

Applies to non-GET requests

Automatically generates token

Stores it in HttpSession

Spring Security uses:

CsrfFilter

The token is stored in:

HttpSessionCsrfTokenRepository

ğŸ§  What Happens Internally

User loads login page.

Spring generates CSRF token.

Token stored in session.

Token added to HTML form as hidden field.

When form is submitted:

Token sent in request.

Spring compares request token with session token.

If match â†’ request allowed.

ğŸ“Œ When Is CSRF Token Needed?

CSRF token is required for:

âœ” POST
âœ” PUT
âœ” PATCH
âœ” DELETE

Not required for:

âœ” GET (safe operations)

ğŸ“Œ When You Can Disable CSRF

You usually disable CSRF when:

Building REST APIs

Using JWT authentication

No session-based auth

Stateless applications

Example:

http.csrf().disable();


But never disable blindly in production.

ğŸ”§ How To Generate CSRF Token in Spring Boot

Spring does it automatically.

If you want to access it manually:

@GetMapping("/csrf-token")
public CsrfToken csrf(CsrfToken token) {
    return token;
}


Spring injects CsrfToken object.

ğŸ“¤ In Frontend (Thymeleaf Example)
<form method="post">
    <input type="hidden" th:name="${_csrf.parameterName}"
           th:value="${_csrf.token}" />
</form>


Spring automatically provides _csrf.

ğŸ§  Important Interview Insight

CSRF is only relevant when:

Authentication is cookie-based

Browser automatically attaches credentials

If using:

JWT in Authorization header

OAuth2 bearer tokens

CSRF is usually not needed.

âš¡ Difference: CSRF vs XSS

CSRF â†’ tricks user to perform action

XSS â†’ injects malicious script into website